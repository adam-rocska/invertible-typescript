<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Recipes | Invertible</title>
<meta name="description" content="Practical patterns for undo, codecs, and reversible workflows." />
<link rel="stylesheet" href="/assets/css/style.css" />
<link rel="icon" href="/assets/img/favicon.svg" />
<script defer src="/assets/js/toc.js"></script>
<script defer src="/assets/js/copy-code.js"></script>
<script defer src="/assets/js/search.js"></script>

  </head>
  <body data-search-index="/search.json">
    <div class="page">
      <nav class="site-nav" aria-label="Primary">
  <a class="brand" href="/">Invertible</a>
  <button class="nav-toggle" aria-expanded="false" aria-controls="nav-menu">Menu</button>
  <div id="nav-menu" class="nav-menu">
    
      
        <a class="nav-link" href="/">Home</a>
      
    
      
        <div class="nav-group">
          <span class="nav-group-title">Start</span>
          
            <a class="nav-link" href="/getting-started/">Getting started</a>
          
            <a class="nav-link" href="/concepts/">Concepts</a>
          
        </div>
      
    
      
        <div class="nav-group">
          <span class="nav-group-title">Guides</span>
          
            <a class="nav-link" href="/pipelines/">Pipelines</a>
          
            <a class="nav-link" href="/recipes/">Recipes</a>
          
            <a class="nav-link" href="/type-utilities/">Type utilities</a>
          
        </div>
      
    
      
        <div class="nav-group">
          <span class="nav-group-title">API</span>
          
            <a class="nav-link" href="/api-reference/invertible/">API: invertible</a>
          
            <a class="nav-link" href="/api-reference/pipe/">API: pipe</a>
          
            <a class="nav-link" href="/api-reference/utility/">API: utility</a>
          
        </div>
      
    
      
        <div class="nav-group">
          <span class="nav-group-title">Reference</span>
          
            <a class="nav-link" href="/faq/">FAQ</a>
          
            <a class="nav-link" href="/release-notes/">Release notes</a>
          
            <a class="nav-link" href="/jekyll-features/">Jekyll features</a>
          
        </div>
      
    
  </div>
</nav>

      <main class="content" id="main">
        <div class="doc-layout">
  <article class="doc-content">
    <header class="doc-header">
      <h1>Recipes</h1>
      <p class="doc-description">Practical patterns for undo, codecs, and reversible workflows.</p>
    </header>
    <h2 id="undoredo-stack">Undo/redo stack</h2>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Invertible</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@adam-rocska/invertible</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">type</span> <span class="nx">State</span> <span class="o">=</span> <span class="p">{</span> <span class="na">count</span><span class="p">:</span> <span class="kr">number</span> <span class="p">};</span>

<span class="kd">const</span> <span class="nx">increment</span> <span class="o">=</span> <span class="nx">Invertible</span><span class="o">&lt;</span><span class="nx">State</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">count</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}),</span>
  <span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">({</span> <span class="p">...</span><span class="nx">state</span><span class="p">,</span> <span class="na">count</span><span class="p">:</span> <span class="nx">state</span><span class="p">.</span><span class="nx">count</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">})</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">stack</span><span class="p">:</span> <span class="nb">Array</span><span class="o">&lt;</span><span class="nb">ReturnType</span><span class="o">&lt;</span><span class="k">typeof</span> <span class="nx">increment</span><span class="o">&gt;&gt;</span> <span class="o">=</span> <span class="p">[];</span>

<span class="kd">const</span> <span class="nx">apply</span> <span class="o">=</span> <span class="k">async </span><span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="nx">State</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">next</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">increment</span><span class="p">(</span><span class="nx">state</span><span class="p">);</span>
  <span class="nx">stack</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">increment</span><span class="p">.</span><span class="nx">inverse</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">next</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">undo</span> <span class="o">=</span> <span class="k">async </span><span class="p">(</span><span class="nx">state</span><span class="p">:</span> <span class="nx">State</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">inverse</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">.</span><span class="nf">pop</span><span class="p">();</span>
  <span class="k">return</span> <span class="nx">inverse</span> <span class="p">?</span> <span class="nf">inverse</span><span class="p">(</span><span class="nx">state</span><span class="p">)</span> <span class="p">:</span> <span class="nx">state</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="bidirectional-data-codec">Bidirectional data codec</h2>

<p>Adapted from tests: turn a <code class="language-plaintext highlighter-rouge">User</code> into a base64 payload and back.</p>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Invertible</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@adam-rocska/invertible</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">pipe</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@adam-rocska/invertible/pipe</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">byteBase64</span> <span class="o">=</span> <span class="nx">Invertible</span><span class="o">&lt;</span><span class="kr">string</span><span class="p">,</span> <span class="nb">Uint8Array</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Uint8Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nf">atob</span><span class="p">(</span><span class="nx">s</span><span class="p">),</span> <span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">c</span><span class="p">.</span><span class="nf">codePointAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">!</span><span class="p">),</span>
  <span class="p">(</span><span class="nx">a</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nf">btoa</span><span class="p">(</span><span class="nb">String</span><span class="p">.</span><span class="nf">fromCharCode</span><span class="p">(...</span><span class="nx">a</span><span class="p">))</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">stringBytes</span> <span class="o">=</span> <span class="nc">Invertible</span><span class="p">(</span>
  <span class="p">(</span><span class="nx">s</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nc">TextEncoder</span><span class="p">().</span><span class="nf">encode</span><span class="p">(</span><span class="nx">s</span><span class="p">),</span>
  <span class="p">(</span><span class="nx">a</span><span class="p">:</span> <span class="nb">Uint8Array</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nc">TextDecoder</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">joinTuple</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">T</span> <span class="kd">extends</span> <span class="k">readonly</span> <span class="kr">any</span><span class="p">[]</span><span class="o">&gt;</span><span class="p">(</span><span class="nx">separator</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nc">Invertible</span><span class="p">(</span>
  <span class="p">(</span><span class="nx">v</span><span class="p">:</span> <span class="nx">T</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">v</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nx">separator</span><span class="p">),</span>
  <span class="p">(</span><span class="nx">s</span><span class="p">:</span> <span class="kr">string</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">s</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="nx">separator</span><span class="p">)</span> <span class="kd">as </span><span class="kr">any</span> <span class="kd">as </span><span class="nx">T</span>
<span class="p">);</span>

<span class="kd">class</span> <span class="nc">User</span> <span class="p">{</span> <span class="nf">constructor</span><span class="p">(</span><span class="k">public</span> <span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="k">public</span> <span class="nx">age</span><span class="p">:</span> <span class="kr">number</span><span class="p">)</span> <span class="p">{}</span> <span class="p">}</span>

<span class="kd">type</span> <span class="nx">UserTuple</span> <span class="o">=</span> <span class="k">readonly</span> <span class="p">[</span><span class="nx">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">age</span><span class="p">:</span> <span class="kr">number</span><span class="p">];</span>

<span class="kd">const</span> <span class="nx">userTuple</span> <span class="o">=</span> <span class="nx">Invertible</span><span class="o">&lt;</span><span class="nx">User</span><span class="p">,</span> <span class="nx">UserTuple</span><span class="o">&gt;</span><span class="p">(</span>
  <span class="p">(</span><span class="nx">u</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nx">u</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">age</span><span class="p">]</span> <span class="kd">as const</span><span class="p">,</span>
  <span class="p">([</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nc">User</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">userCodec</span> <span class="o">=</span> <span class="nf">pipe</span><span class="p">(</span><span class="nx">userTuple</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">pipe</span><span class="p">(</span><span class="nf">joinTuple</span><span class="p">(</span><span class="dl">'</span><span class="s1">|</span><span class="dl">'</span><span class="p">))</span>
  <span class="p">.</span><span class="nf">pipe</span><span class="p">(</span><span class="nx">stringBytes</span><span class="p">)</span>
  <span class="p">.</span><span class="nf">pipe</span><span class="p">(</span><span class="nx">byteBase64</span><span class="p">.</span><span class="nx">inverse</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">User</span><span class="p">(</span><span class="dl">'</span><span class="s1">John Doe</span><span class="dl">'</span><span class="p">,</span> <span class="mi">42</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">payload</span> <span class="o">=</span> <span class="k">await</span> <span class="nf">userCodec</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span> <span class="c1">// "Sm9obiBEb2V8NDI="</span>
</code></pre></div></div>

<h2 id="reversible-ci-tasks">Reversible CI tasks</h2>

<div class="language-ts highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">Invertible</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@adam-rocska/invertible</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">pipe</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">@adam-rocska/invertible/pipe</span><span class="dl">"</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">migrate</span> <span class="o">=</span> <span class="nc">Invertible</span><span class="p">(</span>
  <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">migrate up</span><span class="dl">"</span><span class="p">,</span>
  <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">migrate down</span><span class="dl">"</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">seed</span> <span class="o">=</span> <span class="nc">Invertible</span><span class="p">(</span>
  <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">seed data</span><span class="dl">"</span><span class="p">,</span>
  <span class="k">async </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="dl">"</span><span class="s2">remove seed</span><span class="dl">"</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">pipeline</span> <span class="o">=</span> <span class="nf">pipe</span><span class="p">(</span><span class="nx">migrate</span><span class="p">,</span> <span class="nx">seed</span><span class="p">);</span>

<span class="k">await</span> <span class="nf">pipeline</span><span class="p">();</span>
<span class="k">await</span> <span class="nx">pipeline</span><span class="p">.</span><span class="nf">inverse</span><span class="p">();</span>
</code></pre></div></div>

  </article>
  
<aside class="toc" aria-label="Table of contents">
  <div class="toc-title">On this page</div>
  <nav id="toc-list"></nav>
</aside>


</div>

      </main>
      <footer class="site-footer">
  <div class="footer-grid">
    <div>
      <strong>Invertible</strong>
      <p>Type-safe invertible functions and pipelines for TypeScript.</p>
    </div>
    <div>
      <strong>Docs</strong>
      <a href="/getting-started/">Getting started</a>
      <a href="/api-reference/invertible/">API reference</a>
    </div>
    <div>
      <strong>Repository</strong>
      <a href="https://github.com/adam-rocska/invertible-typescript">GitHub</a>
      <a href="https://github.com/adam-rocska/invertible-typescript/issues">Issues</a>
    </div>
  </div>
  <div class="footer-meta">Last build: 2026-01-31 15:16 UTC</div>
</footer>

    </div>
    <script>
      const toggle = document.querySelector('.nav-toggle');
      const menu = document.querySelector('#nav-menu');
      if (toggle && menu) {
        toggle.addEventListener('click', () => {
          const expanded = toggle.getAttribute('aria-expanded') === 'true';
          toggle.setAttribute('aria-expanded', String(!expanded));
          menu.classList.toggle('open', !expanded);
        });
      }
    </script>
  </body>
</html>
